<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pot of Gold - Complete Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            touch-action: none;
        }

        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #mainMenu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 5000;
        }

        #mainMenu.hidden {
            display: none;
        }

        .menu-logo {
            font-size: 72px;
            margin-bottom: 20px;
        }

        .menu-title {
            color: #FFD700;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .menu-subtitle {
            color: white;
            font-size: 18px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 300px;
            max-width: 90%;
        }

        .menu-button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .menu-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }

        .menu-button:active {
            transform: scale(0.95);
        }

        .menu-button.secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            text-align: right;
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .user-info .username {
            font-weight: bold;
            color: #FFD700;
        }

        .user-info .stats {
            font-size: 12px;
            margin-top: 5px;
        }

        #loginModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 6000;
        }

        #loginModal.active {
            display: flex;
        }

        .login-content {
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }

        .login-header {
            color: #FFD700;
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .login-input {
            padding: 12px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .login-input:focus {
            outline: none;
            border-color: #FFD700;
        }

        .login-button {
            padding: 12px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-button:active {
            transform: scale(0.95);
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .login-link {
            color: #FFD700;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
        }

        .login-link:hover {
            text-decoration: underline;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: none;
            flex-direction: column;
        }

        #gameContainer.active {
            display: flex;
        }

        /* Header UI */
        #header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        #stats {
            display: flex;
            gap: 15px;
            color: white;
            font-weight: bold;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
        }

        .combo-display {
            position: absolute;
            top: 70px;
            right: 20px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            display: none;
            animation: comboPopup 0.3s ease-out;
            z-index: 1001;
        }

        .combo-display.active {
            display: block;
        }

        @keyframes comboPopup {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        #pauseBtn {
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #FFD700;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #pauseBtn:active {
            transform: scale(0.95);
        }

        #soundToggle {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #FFD700;
            border-radius: 20px;
            padding: 5px 15px;
            color: white;
            cursor: pointer;
            font-size: 20px;
            z-index: 1002;
        }

        /* Game Canvas */
        #gameCanvas {
            position: absolute;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 120px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 100%);
        }

        /* Cart/Pot */
        #cart {
            position: absolute;
            bottom: 120px;
            width: 60px;
            height: 50px;
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 10px 10px 20px 20px;
            transition: left 0.1s ease-out;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }

        #cart.gold-skin {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-color: #FF8C00;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #cart.diamond-skin {
            background: linear-gradient(135deg, #E0E0E0, #87CEEB);
            border-color: #4169E1;
            box-shadow: 0 0 20px rgba(135, 206, 235, 0.5);
        }

        #cart.rainbow-skin {
            background: linear-gradient(135deg, red, orange, yellow, green, blue, indigo, violet);
            border-color: #FF1493;
            animation: rainbow 2s linear infinite;
        }

        @keyframes rainbow {
            to { filter: hue-rotate(360deg); }
        }

        /* Falling Items */
        .falling-item {
            position: absolute;
            width: 30px;
            height: 30px;
            font-size: 24px;
            animation: fall linear;
            z-index: 50;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        /* Missed Items (Blockage) */
        .missed-item {
            position: absolute;
            bottom: 0;
            width: 25px;
            height: 25px;
            font-size: 18px;
            opacity: 0.7;
            z-index: 60;
        }

        /* Power-up Bar */
        #powerUpBar {
            position: absolute;
            top: 130px;
            left: 20px;
            right: 20px;
            height: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            display: none;
            align-items: center;
            padding: 0 10px;
            z-index: 200;
        }

        #powerUpBar.active {
            display: flex;
        }

        .power-up-fill {
            height: 20px;
            background: linear-gradient(90deg, #00FF00, #00AA00);
            border-radius: 10px;
            transition: width 0.3s;
        }

        /* Daily Reward Banner */
        #dailyReward {
            position: absolute;
            top: 170px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
            animation: slideDown 0.5s ease-out;
            z-index: 201;
        }

        #dailyReward.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
            display: none;
            animation: achievementBounce 0.5s ease-out;
            z-index: 2001;
            text-align: center;
        }

        .achievement-popup.active {
            display: block;
        }

        @keyframes achievementBounce {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Bottom Menu */
        #bottomMenu {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            z-index: 100;
        }

        .menu-btn {
            flex: 1;
            max-width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid #FFD700;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
        }

        .menu-btn:active {
            transform: scale(0.95);
        }

        .menu-btn.locked {
            opacity: 0.5;
            background: gray;
        }

        .menu-btn .icon {
            font-size: 24px;
        }

        .menu-btn .price {
            font-size: 10px;
            color: #FFD700;
        }

        /* Pause Menu */
        #pauseMenu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        #pauseMenu.active {
            display: flex;
        }

        .pause-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .pause-content h2 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 32px;
        }

        .pause-btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #FFD700;
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .pause-btn:active {
            transform: scale(0.95);
        }

        /* Shop Modal */
        #shopModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        #shopModal.active {
            display: flex;
        }

        .shop-content {
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            border-radius: 20px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .shop-balance {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .balance-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
        }

        .shop-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .shop-tab {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-tab.active {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.2);
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-item:hover {
            border-color: #FFD700;
            transform: scale(1.05);
        }

        .shop-item.purchased {
            border-color: #00FF00;
            background: rgba(0, 255, 0, 0.1);
        }

        .shop-item.equipped {
            border-color: #00FFFF;
            background: rgba(0, 255, 255, 0.2);
        }

        .shop-item-icon {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .shop-item-name {
            color: white;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .shop-item-price {
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
        }

        /* Leaderboard Modal */
        #leaderboardModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        #leaderboardModal.active {
            display: flex;
        }

        .leaderboard-content {
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            border-radius: 20px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .leaderboard-tab {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            text-align: center;
        }

        .leaderboard-tab.active {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.2);
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            color: white;
        }

        .leaderboard-item.current-user {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
        }

        .leaderboard-rank {
            font-size: 20px;
            font-weight: bold;
            width: 40px;
            text-align: center;
        }

        .leaderboard-rank.gold {
            color: #FFD700;
        }

        .leaderboard-rank.silver {
            color: #C0C0C0;
        }

        .leaderboard-rank.bronze {
            color: #CD7F32;
        }

        .leaderboard-name {
            flex: 1;
            margin: 0 15px;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #FFD700;
        }

        /* Achievements Modal */
        #achievementsModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        #achievementsModal.active {
            display: flex;
        }

        .achievements-content {
            background: linear-gradient(135deg, #1a1a2e, #0f0f1e);
            border-radius: 20px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .achievement-item.unlocked {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .achievement-item:hover {
            transform: scale(1.05);
        }

        .achievement-icon {
            font-size: 32px;
            margin-bottom: 5px;
            filter: grayscale(100%);
        }

        .achievement-item.unlocked .achievement-icon {
            filter: none;
        }

        .achievement-name {
            color: white;
            font-size: 10px;
        }

        .achievement-progress {
            margin-top: 5px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            background: #FFD700;
            transition: width 0.3s;
        }

        /* Game Over */
        #gameOver {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 4000;
        }

        #gameOver.active {
            display: flex;
        }

        .game-over-content {
            background: linear-gradient(135deg, #DC143C, #8B0000);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .game-over-content h2 {
            color: #FFD700;
            margin-bottom: 20px;
            font-size: 36px;
        }

        .final-stats {
            color: white;
            margin: 20px 0;
            font-size: 18px;
            line-height: 1.5;
        }

        .new-record {
            color: #FFD700;
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
            animation: pulse 1s infinite;
        }

        /* Warning Banner */
        #warningBanner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            display: none;
            z-index: 500;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        #warningBanner.active {
            display: block;
        }

        /* Mobile Controls */
        .touch-zone {
            position: absolute;
            top: 70px;
            bottom: 120px;
            width: 50%;
            z-index: 10;
        }

        #leftTouch {
            left: 0;
        }

        #rightTouch {
            right: 0;
        }

        /* Transaction History */
        .transaction-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            color: white;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-amount {
            color: #FFD700;
            font-weight: bold;
        }

        .transaction-amount.spent {
            color: #FF6B6B;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .menu-title {
                font-size: 36px;
            }
            
            .stat {
                font-size: 12px;
                padding: 3px 6px;
            }
            
            .menu-btn {
                max-width: 60px;
                height: 60px;
                font-size: 10px;
            }
            
            .menu-btn .icon {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-content">
            <div style="font-size: 72px;">🍯</div>
            <h1 style="color: #FFD700; font-size: 36px; margin: 20px 0;">Pot of Gold</h1>
            <div class="loading-spinner"></div>
            <p>Loading amazing gameplay...</p>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="mainMenu" class="hidden">
        <div class="user-info" id="userInfo" style="display: none;">
            <div class="username" id="displayUsername">Guest</div>
            <div class="stats">
                <div>Best Score: <span id="bestScore">0</span></div>
                <div>Total Coins: <span id="totalCoins">0</span></div>
            </div>
        </div>
        
        <div class="menu-logo">🍯</div>
        <h1 class="menu-title">Pot of Gold</h1>
        <p class="menu-subtitle">Catch the falling treasures!</p>
        
        <div class="menu-buttons">
            <button class="menu-button" id="playBtn">Play Game</button>
            <button class="menu-button" id="leaderboardBtn">Leaderboard</button>
            <button class="menu-button" id="achievementsBtn">Achievements</button>
            <button class="menu-button secondary" id="accountBtn">Account</button>
            <button class="menu-button secondary" id="settingsBtn">Settings</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal">
        <div class="login-content">
            <h2 class="login-header">Welcome Back!</h2>
            <div class="login-form">
                <input type="text" class="login-input" id="usernameInput" placeholder="Username">
                <input type="password" class="login-input" id="passwordInput" placeholder="Password">
                <button class="login-button" id="loginBtn">Login</button>
                <button class="login-button" id="signupBtn">Sign Up</button>
                <button class="login-button" id="guestBtn">Play as Guest</button>
            </div>
            <div class="login-options">
                <a class="login-link" id="forgotPassword">Forgot Password?</a>
                <a class="login-link" id="closeLogin">Close</a>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <!-- Header UI -->
        <div id="header">
            <div id="stats">
                <div class="stat">💰 <span id="coins">0</span></div>
                <div class="stat">⭐ <span id="score">0</span></div>
                <div class="stat">🎯 <span id="level">1</span></div>
                <div class="stat">❤️ <span id="lives">3</span></div>
            </div>
            <button id="pauseBtn">⏸️</button>
        </div>

        <!-- Sound Toggle -->
        <button id="soundToggle">🔊</button>

        <!-- Combo Display -->
        <div class="combo-display" id="comboDisplay">
            <span id="comboText">Combo x2!</span>
        </div>

        <!-- Power-up Indicator -->
        <div id="powerUpBar">
            <div class="power-up-fill" style="width: 0%"></div>
        </div>

        <!-- Daily Reward Banner -->
        <div id="dailyReward">
            🎁 Daily Reward: +50 Coins!
        </div>

        <!-- Achievement Popup -->
        <div class="achievement-popup" id="achievementPopup">
            <div>🏆 Achievement Unlocked!</div>
            <div id="achievementName">First Steps</div>
        </div>

        <!-- Warning Banner -->
        <div id="warningBanner">
            ⚠️ Path is getting blocked! Use power-ups to clear!
        </div>

        <!-- Game Canvas -->
        <div id="gameCanvas">
            <!-- Cart/Pot -->
            <div id="cart">🍯</div>
            
            <!-- Touch zones for mobile -->
            <div id="leftTouch" class="touch-zone"></div>
            <div id="rightTouch" class="touch-zone"></div>
        </div>

        <!-- Bottom Menu -->
        <div id="bottomMenu">
            <button class="menu-btn" id="shopBtn">
                <span class="icon">🛍️</span>
                <span>Shop</span>
            </button>
            <button class="menu-btn" id="vacuumBtn">
                <span class="icon">🌪️</span>
                <span>Vacuum</span>
                <span class="price">50💰</span>
            </button>
            <button class="menu-btn" id="clearBtn">
                <span class="icon">💥</span>
                <span>Clear All</span>
                <span class="price">100💰</span>
            </button>
            <button class="menu-btn" id="magnetBtn">
                <span class="icon">🧲</span>
                <span>Magnet</span>
                <span class="price">75💰</span>
            </button>
            <button class="menu-btn" id="boostBtn">
                <span class="icon">⚡</span>
                <span>Boost</span>
                <span class="price">25💰</span>
            </button>
        </div>

        <!-- Pause Menu -->
        <div id="pauseMenu">
            <div class="pause-content">
                <h2>⏸️ PAUSED</h2>
                <button class="pause-btn" id="resumeBtn">Resume Game</button>
                <button class="pause-btn" id="restartBtn">Restart</button>
                <button class="pause-btn" id="shopPauseBtn">Shop</button>
                <button class="pause-btn" id="mainMenuPauseBtn">Main Menu</button>
            </div>
        </div>

        <!-- Shop Modal -->
        <div id="shopModal">
            <div class="shop-content">
                <div class="shop-header">
                    <h2>🛍️ SHOP</h2>
                    <button id="closeShopBtn" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">✖️</button>
                </div>
                
                <div class="shop-balance">
                    <div class="balance-item">💰 <span id="shopCoins">0</span></div>
                    <div class="balance-item">💎 <span id="shopGems">0</span></div>
                </div>
                
                <div class="shop-tabs">
                    <div class="shop-tab active" data-tab="skins">Skins</div>
                    <div class="shop-tab" data-tab="upgrades">Upgrades</div>
                    <div class="shop-tab" data-tab="powerups">Power-ups</div>
                    <div class="shop-tab" data-tab="history">History</div>
                </div>
                
                <div class="shop-items" id="shopItems">
                    <!-- Items will be dynamically added -->
                </div>
                
                <div class="transaction-list" id="transactionList" style="display: none;">
                    <!-- Transaction history will be added here -->
                </div>
            </div>
        </div>

        <!-- Leaderboard Modal -->
        <div id="leaderboardModal">
            <div class="leaderboard-content">
                <div class="leaderboard-header">
                    <h2>🏆 LEADERBOARD</h2>
                    <button id="closeLeaderboardBtn" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">✖️</button>
                </div>
                
                <div class="leaderboard-tabs">
                    <div class="leaderboard-tab active" data-period="daily">Daily</div>
                    <div class="leaderboard-tab" data-period="weekly">Weekly</div>
                    <div class="leaderboard-tab" data-period="alltime">All Time</div>
                </div>
                
                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Leaderboard entries will be added here -->
                </div>
            </div>
        </div>

        <!-- Achievements Modal -->
        <div id="achievementsModal">
            <div class="achievements-content">
                <div class="leaderboard-header">
                    <h2>🏆 ACHIEVEMENTS</h2>
                    <button id="closeAchievementsBtn" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">✖️</button>
                </div>
                
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Achievement items will be added here -->
                </div>
            </div>
        </div>

        <!-- Game Over -->
        <div id="gameOver">
            <div class="game-over-content">
                <h2>💀 GAME OVER</h2>
                <div class="new-record" id="newRecord" style="display: none;">
                    🎉 NEW HIGH SCORE! 🎉
                </div>
                <div class="final-stats">
                    <div>Final Score: <span id="finalScore">0</span></div>
                    <div>Coins Collected: <span id="finalCoins">0</span></div>
                    <div>Level Reached: <span id="finalLevel">1</span></div>
                    <div>Time Survived: <span id="finalTime">0</span>s</div>
                </div>
                <button class="pause-btn" id="playAgainBtn">Play Again</button>
                <button class="pause-btn" id="mainMenuBtn">Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Sound Manager
        class SoundManager {
            constructor() {
                this.enabled = true;
                this.context = null;
                this.sounds = {};
                this.volume = 0.5;
            }

            init() {
                try {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.context = new AudioContext();
                    this.createSounds();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            createSounds() {
                // Create simple synthesized sounds
                this.sounds.collect = () => this.playTone(800, 0.1, 'sine');
                this.sounds.powerup = () => this.playTone(1200, 0.2, 'square');
                this.sounds.damage = () => this.playTone(200, 0.3, 'sawtooth');
                this.sounds.levelup = () => {
                    this.playTone(400, 0.1, 'sine');
                    setTimeout(() => this.playTone(600, 0.1, 'sine'), 100);
                    setTimeout(() => this.playTone(800, 0.2, 'sine'), 200);
                };
                this.sounds.achievement = () => {
                    this.playTone(600, 0.1, 'sine');
                    setTimeout(() => this.playTone(800, 0.1, 'sine'), 100);
                    setTimeout(() => this.playTone(1000, 0.3, 'sine'), 200);
                };
                this.sounds.button = () => this.playTone(600, 0.05, 'sine');
                this.sounds.warning = () => this.playTone(300, 0.5, 'sawtooth');
                this.sounds.gameover = () => {
                    this.playTone(400, 0.2, 'sawtooth');
                    setTimeout(() => this.playTone(300, 0.2, 'sawtooth'), 200);
                    setTimeout(() => this.playTone(200, 0.4, 'sawtooth'), 400);
                };
            }

            playTone(frequency, duration, type = 'sine') {
                if (!this.enabled || !this.context) return;

                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = type;

                gainNode.gain.setValueAtTime(this.volume, this.context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + duration);

                oscillator.start(this.context.currentTime);
                oscillator.stop(this.context.currentTime + duration);
            }

            play(soundName) {
                if (this.sounds[soundName]) {
                    this.sounds[soundName]();
                }
            }

            toggle() {
                this.enabled = !this.enabled;
                return this.enabled;
            }
        }

        // User Account Manager
        class UserAccount {
            constructor() {
                this.currentUser = null;
                this.isGuest = true;
                this.users = this.loadUsers();
            }

            loadUsers() {
                const saved = localStorage.getItem('potOfGoldUsers');
                return saved ? JSON.parse(saved) : {};
            }

            saveUsers() {
                localStorage.setItem('potOfGoldUsers', JSON.stringify(this.users));
            }

            login(username, password) {
                if (this.users[username] && this.users[username].password === password) {
                    this.currentUser = this.users[username];
                    this.isGuest = false;
                    localStorage.setItem('currentUser', username);
                    return true;
                }
                return false;
            }

            signup(username, password) {
                if (this.users[username]) {
                    return false; // User already exists
                }

                this.users[username] = {
                    username: username,
                    password: password,
                    bestScore: 0,
                    totalCoins: 0,
                    totalGems: 0,
                    achievements: [],
                    purchases: [],
                    transactions: [],
                    dailyRewardLastClaimed: null,
                    stats: {
                        gamesPlayed: 0,
                        totalPlayTime: 0,
                        itemsCollected: 0,
                        powerupsUsed: 0
                    }
                };

                this.saveUsers();
                return this.login(username, password);
            }

            playAsGuest() {
                this.currentUser = {
                    username: 'Guest',
                    bestScore: 0,
                    totalCoins: 0,
                    totalGems: 0,
                    achievements: [],
                    purchases: [],
                    transactions: [],
                    stats: {
                        gamesPlayed: 0,
                        totalPlayTime: 0,
                        itemsCollected: 0,
                        powerupsUsed: 0
                    }
                };
                this.isGuest = true;
            }

            logout() {
                this.currentUser = null;
                this.isGuest = true;
                localStorage.removeItem('currentUser');
            }

            updateUserData(data) {
                if (!this.currentUser) return;

                Object.assign(this.currentUser, data);

                if (!this.isGuest) {
                    this.users[this.currentUser.username] = this.currentUser;
                    this.saveUsers();
                }
            }

            addTransaction(type, amount, item) {
                if (!this.currentUser) return;

                const transaction = {
                    type: type, // 'purchase', 'earn', 'spend'
                    amount: amount,
                    item: item,
                    timestamp: new Date().toISOString()
                };

                if (!this.currentUser.transactions) {
                    this.currentUser.transactions = [];
                }

                this.currentUser.transactions.unshift(transaction);
                
                // Keep only last 50 transactions
                if (this.currentUser.transactions.length > 50) {
                    this.currentUser.transactions = this.currentUser.transactions.slice(0, 50);
                }

                this.updateUserData(this.currentUser);
            }

            canClaimDailyReward() {
                if (!this.currentUser) return false;

                const lastClaimed = this.currentUser.dailyRewardLastClaimed;
                if (!lastClaimed) return true;

                const lastDate = new Date(lastClaimed);
                const now = new Date();
                
                return now.getDate() !== lastDate.getDate() || 
                       now.getMonth() !== lastDate.getMonth() || 
                       now.getFullYear() !== lastDate.getFullYear();
            }

            claimDailyReward() {
                if (!this.currentUser || !this.canClaimDailyReward()) return 0;

                const reward = 50 + Math.floor(Math.random() * 50); // 50-100 coins
                this.currentUser.totalCoins += reward;
                this.currentUser.dailyRewardLastClaimed = new Date().toISOString();
                this.addTransaction('earn', reward, 'Daily Reward');
                this.updateUserData(this.currentUser);
                
                return reward;
            }
        }

        // Achievement System
        class AchievementSystem {
            constructor() {
                this.achievements = [
                    { id: 'first_coin', name: 'First Steps', icon: '🥇', description: 'Collect your first coin', progress: 0, target: 1, unlocked: false },
                    { id: 'coin_collector', name: 'Coin Collector', icon: '💰', description: 'Collect 100 coins', progress: 0, target: 100, unlocked: false },
                    { id: 'coin_master', name: 'Coin Master', icon: '🏆', description: 'Collect 1000 coins', progress: 0, target: 1000, unlocked: false },
                    { id: 'survivor', name: 'Survivor', icon: '⏱️', description: 'Survive for 60 seconds', progress: 0, target: 60, unlocked: false },
                    { id: 'combo_starter', name: 'Combo Starter', icon: '🔥', description: 'Get a 5x combo', progress: 0, target: 5, unlocked: false },
                    { id: 'combo_master', name: 'Combo Master', icon: '💥', description: 'Get a 10x combo', progress: 0, target: 10, unlocked: false },
                    { id: 'level_5', name: 'Level 5', icon: '5️⃣', description: 'Reach level 5', progress: 0, target: 5, unlocked: false },
                    { id: 'level_10', name: 'Level 10', icon: '🔟', description: 'Reach level 10', progress: 0, target: 10, unlocked: false },
                    { id: 'powerup_user', name: 'Power Player', icon: '⚡', description: 'Use 10 power-ups', progress: 0, target: 10, unlocked: false },
                    { id: 'skin_collector', name: 'Fashion Star', icon: '👗', description: 'Unlock 3 skins', progress: 0, target: 3, unlocked: false },
                    { id: 'high_scorer', name: 'High Scorer', icon: '📊', description: 'Score 1000 points', progress: 0, target: 1000, unlocked: false },
                    { id: 'perfect_run', name: 'Perfect Run', icon: '✨', description: 'Complete a level without damage', progress: 0, target: 1, unlocked: false }
                ];
            }

            check(type, value) {
                const unlocked = [];
                
                this.achievements.forEach(achievement => {
                    if (achievement.unlocked) return;

                    let shouldUnlock = false;

                    switch(achievement.id) {
                        case 'first_coin':
                            if (type === 'coins' && value >= 1) {
                                achievement.progress = 1;
                                shouldUnlock = true;
                            }
                            break;
                        case 'coin_collector':
                            if (type === 'total_coins') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'coin_master':
                            if (type === 'total_coins') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'survivor':
                            if (type === 'time') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'combo_starter':
                            if (type === 'combo') {
                                achievement.progress = Math.max(achievement.progress, value);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'combo_master':
                            if (type === 'combo') {
                                achievement.progress = Math.max(achievement.progress, value);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'level_5':
                        case 'level_10':
                            if (type === 'level') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'powerup_user':
                            if (type === 'powerups_used') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                        case 'high_scorer':
                            if (type === 'score') {
                                achievement.progress = Math.min(value, achievement.target);
                                shouldUnlock = value >= achievement.target;
                            }
                            break;
                    }

                    if (shouldUnlock) {
                        achievement.unlocked = true;
                        unlocked.push(achievement);
                    }
                });

                return unlocked;
            }

            getProgress() {
                const total = this.achievements.length;
                const unlocked = this.achievements.filter(a => a.unlocked).length;
                return { unlocked, total, percentage: (unlocked / total * 100).toFixed(1) };
            }
        }

        // Leaderboard System
        class LeaderboardSystem {
            constructor() {
                this.leaderboards = {
                    daily: [],
                    weekly: [],
                    alltime: []
                };
                this.loadLeaderboards();
            }

            loadLeaderboards() {
                const saved = localStorage.getItem('potOfGoldLeaderboards');
                if (saved) {
                    this.leaderboards = JSON.parse(saved);
                }
            }

            saveLeaderboards() {
                localStorage.setItem('potOfGoldLeaderboards', JSON.stringify(this.leaderboards));
            }

            submitScore(username, score) {
                const entry = {
                    username: username,
                    score: score,
                    timestamp: new Date().toISOString()
                };

                // Add to all time
                this.addToLeaderboard('alltime', entry);

                // Add to daily (reset daily at midnight)
                this.addToLeaderboard('daily', entry);

                // Add to weekly (reset weekly)
                this.addToLeaderboard('weekly', entry);

                this.saveLeaderboards();
            }

            addToLeaderboard(type, entry) {
                this.leaderboards[type].push(entry);
                this.leaderboards[type].sort((a, b) => b.score - a.score);
                
                // Keep only top 100
                if (this.leaderboards[type].length > 100) {
                    this.leaderboards[type] = this.leaderboards[type].slice(0, 100);
                }
            }

            getLeaderboard(type, limit = 10) {
                return this.leaderboards[type].slice(0, limit);
            }

            getUserRank(type, username) {
                const index = this.leaderboards[type].findIndex(e => e.username === username);
                return index === -1 ? null : index + 1;
            }
        }

        // Main Game Class
        class PotOfGoldGame {
            constructor() {
                this.soundManager = new SoundManager();
                this.userAccount = new UserAccount();
                this.achievementSystem = new AchievementSystem();
                this.leaderboardSystem = new LeaderboardSystem();
                
                this.game = {
                    coins: 0,
                    gems: 0,
                    score: 0,
                    level: 1,
                    lives: 3,
                    isPaused: false,
                    isGameOver: false,
                    cartPosition: window.innerWidth / 2,
                    cartSpeed: 5,
                    fallingItems: [],
                    missedItems: [],
                    blockageLevel: 0,
                    combo: 0,
                    maxCombo: 0,
                    powerUps: {
                        magnet: false,
                        boost: false,
                        vacuum: false,
                        shield: false,
                        doubleCoins: false
                    },
                    startTime: Date.now(),
                    selectedSkin: 'default',
                    purchasedSkins: ['default'],
                    upgrades: {
                        cartSize: 1,
                        cartSpeed: 1,
                        magnetRange: 1,
                        coinValue: 1
                    },
                    stats: {
                        itemsCollected: 0,
                        powerupsUsed: 0,
                        totalCoinsThisRun: 0
                    }
                };

                this.shopData = {
                    skins: [
                        { id: 'default', name: 'Classic Pot', icon: '🍯', price: 0, purchased: true },
                        { id: 'gold', name: 'Golden Pot', icon: '🏆', price: 500, purchased: false },
                        { id: 'diamond', name: 'Diamond Cart', icon: '💎', price: 1000, purchased: false },
                        { id: 'rainbow', name: 'Rainbow Cart', icon: '🌈', price: 2000, purchased: false }
                    ],
                    upgrades: [
                        { id: 'size', name: 'Bigger Cart', icon: '📏', price: 300, level: 1, maxLevel: 5 },
                        { id: 'speed', name: 'Faster Move', icon: '🏃', price: 200, level: 1, maxLevel: 5 },
                        { id: 'magnet', name: 'Magnet Range', icon: '🧲', price: 400, level: 1, maxLevel: 5 },
                        { id: 'value', name: 'Coin Value', icon: '💰', price: 500, level: 1, maxLevel: 5 }
                    ],
                    powerups: [
                        { id: 'extra_life', name: 'Extra Life', icon: '❤️', price: 150, count: 0 },
                        { id: 'shield', name: 'Shield', icon: '🛡️', price: 100, count: 0 },
                        { id: 'double_coins', name: '2x Coins', icon: '💰💰', price: 200, count: 0 },
                        { id: 'slow_time', name: 'Slow Time', icon: '⏰', price: 250, count: 0 }
                    ]
                };

                this.itemTypes = [
                    { type: 'coin', emoji: '🪙', value: 1, points: 10, harmful: false, probability: 0.4 },
                    { type: 'gem', emoji: '💎', value: 5, points: 50, harmful: false, probability: 0.15 },
                    { type: 'star', emoji: '⭐', value: 3, points: 30, harmful: false, probability: 0.2 },
                    { type: 'money', emoji: '💵', value: 10, points: 100, harmful: false, probability: 0.05 },
                    { type: 'bomb', emoji: '💣', value: 0, points: -50, harmful: true, probability: 0.15 },
                    { type: 'rock', emoji: '🪨', value: 0, points: 0, harmful: true, probability: 0.05 }
                ];

                this.init();
            }

            init() {
                this.soundManager.init();
                this.setupEventListeners();
                this.checkAutoLogin();
                
                // Hide loading screen and show main menu
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainMenu').classList.remove('hidden');
                    this.checkDailyReward();
                }, 1500);
            }

            checkAutoLogin() {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser && this.userAccount.users[savedUser]) {
                    this.userAccount.login(savedUser, this.userAccount.users[savedUser].password);
                    this.updateUserDisplay();
                }
            }

            checkDailyReward() {
                if (this.userAccount.currentUser && this.userAccount.canClaimDailyReward()) {
                    const reward = this.userAccount.claimDailyReward();
                    if (reward > 0) {
                        this.showDailyReward(reward);
                    }
                }
            }

            showDailyReward(amount) {
                const banner = document.getElementById('dailyReward');
                banner.textContent = `🎁 Daily Reward: +${amount} Coins!`;
                banner.classList.add('active');
                this.soundManager.play('achievement');
                
                setTimeout(() => {
                    banner.classList.remove('active');
                }, 3000);
            }

            updateUserDisplay() {
                const userInfo = document.getElementById('userInfo');
                const displayUsername = document.getElementById('displayUsername');
                const bestScore = document.getElementById('bestScore');
                const totalCoins = document.getElementById('totalCoins');

                if (this.userAccount.currentUser) {
                    userInfo.style.display = 'block';
                    displayUsername.textContent = this.userAccount.currentUser.username;
                    bestScore.textContent = this.userAccount.currentUser.bestScore || 0;
                    totalCoins.textContent = this.userAccount.currentUser.totalCoins || 0;
                } else {
                    userInfo.style.display = 'none';
                }
            }

            startGame() {
                if (!this.userAccount.currentUser) {
                    this.showLogin();
                    return;
                }

                document.getElementById('mainMenu').classList.add('hidden');
                document.getElementById('gameContainer').classList.add('active');
                
                this.resetGame();
                this.game.isPaused = false;
                this.game.isGameOver = false;
                this.game.startTime = Date.now();
                
                this.gameLoop();
                this.spawnItems();
                
                // Update user stats
                if (this.userAccount.currentUser) {
                    this.userAccount.currentUser.stats.gamesPlayed++;
                    this.userAccount.updateUserData(this.userAccount.currentUser);
                }
            }

            resetGame() {
                // Clear all items
                this.game.fallingItems.forEach(obj => obj.element && obj.element.remove());
                this.game.missedItems.forEach(obj => obj.element && obj.element.remove());
                
                // Reset game state
                this.game.coins = 0;
                this.game.score = 0;
                this.game.level = 1;
                this.game.lives = 3;
                this.game.combo = 0;
                this.game.maxCombo = 0;
                this.game.fallingItems = [];
                this.game.missedItems = [];
                this.game.blockageLevel = 0;
                this.game.stats = {
                    itemsCollected: 0,
                    powerupsUsed: 0,
                    totalCoinsThisRun: 0
                };
                
                // Reset cart position
                this.game.cartPosition = window.innerWidth / 2;
                const cart = document.getElementById('cart');
                cart.style.left = (this.game.cartPosition - 30) + 'px';
                
                this.updateUI();
            }

            gameLoop() {
                if (this.game.isPaused || this.game.isGameOver) return;

                this.updateFallingItems();
                this.checkCollisions();
                this.updateBlockage();
                this.checkGameOver();
                this.updateUI();

                requestAnimationFrame(() => this.gameLoop());
            }

            spawnItems() {
                if (this.game.isPaused || this.game.isGameOver) return;

                const spawnRate = Math.max(500, 2000 - (this.game.level * 100));
                const item = this.selectRandomItem();
                const x = Math.random() * (window.innerWidth - 30);
                
                this.createFallingItem(item, x);

                setTimeout(() => this.spawnItems(), spawnRate);
            }

            selectRandomItem() {
                const rand = Math.random();
                let cumulative = 0;
                
                for (const item of this.itemTypes) {
                    cumulative += item.probability;
                    if (rand <= cumulative) {
                        return item;
                    }
                }
                return this.itemTypes[0];
            }

            createFallingItem(item, x) {
                const element = document.createElement('div');
                element.className = 'falling-item';
                element.style.left = x + 'px';
                element.style.top = '0px';
                element.textContent = item.emoji;
                
                const fallSpeed = 3 + (this.game.level * 0.5);
                element.style.animationDuration = (10 / fallSpeed) + 's';
                
                document.getElementById('gameCanvas').appendChild(element);
                
                this.game.fallingItems.push({
                    element: element,
                    x: x,
                    y: 0,
                    item: item
                });
            }

            updateFallingItems() {
                const canvas = document.getElementById('gameCanvas');
                const canvasHeight = canvas.offsetHeight;
                
                this.game.fallingItems = this.game.fallingItems.filter(obj => {
                    const rect = obj.element.getBoundingClientRect();
                    const canvasRect = canvas.getBoundingClientRect();
                    const relativeY = rect.top - canvasRect.top;
                    
                    if (relativeY > canvasHeight - 30) {
                        // Item missed
                        if (!obj.item.harmful) {
                            this.addMissedItem(obj.x, obj.item);
                            this.game.combo = 0; // Reset combo on miss
                            this.updateComboDisplay();
                        }
                        obj.element.remove();
                        return false;
                    }
                    return true;
                });
            }

            addMissedItem(x, item) {
                const element = document.createElement('div');
                element.className = 'missed-item';
                element.style.left = x + 'px';
                element.style.bottom = (this.game.missedItems.length * 5) + 'px';
                element.textContent = item.emoji;
                
                document.getElementById('gameCanvas').appendChild(element);
                this.game.missedItems.push({ element: element, x: x });
                
                this.updateBlockage();
            }

            updateBlockage() {
                this.game.blockageLevel = this.game.missedItems.length / 20;
                
                if (this.game.blockageLevel > 0.25 && this.game.blockageLevel < 0.5) {
                    this.showWarning();
                } else {
                    this.hideWarning();
                }
                
                const cartWidth = 60 * this.game.upgrades.cartSize;
                const maxBlockageHeight = this.game.missedItems.length * 5;
                
                if (maxBlockageHeight > 50) {
                    const restrictionFactor = Math.min(1, maxBlockageHeight / 100);
                    this.game.cartSpeed = 5 * (1 - restrictionFactor * 0.5) * this.game.upgrades.cartSpeed;
                }
            }

            showWarning() {
                const banner = document.getElementById('warningBanner');
                banner.classList.add('active');
                this.soundManager.play('warning');
                setTimeout(() => banner.classList.remove('active'), 3000);
            }

            hideWarning() {
                document.getElementById('warningBanner').classList.remove('active');
            }

            checkCollisions() {
                const cart = document.getElementById('cart');
                const cartRect = cart.getBoundingClientRect();
                const cartWidth = 60 * this.game.upgrades.cartSize;
                
                this.game.fallingItems.forEach((obj, index) => {
                    const itemRect = obj.element.getBoundingClientRect();
                    
                    if (itemRect.bottom >= cartRect.top &&
                        itemRect.top <= cartRect.bottom &&
                        itemRect.left < cartRect.right &&
                        itemRect.right > cartRect.left) {
                        
                        const item = obj.item;
                        
                        if (item.harmful) {
                            if (!this.game.powerUps.shield) {
                                this.game.lives--;
                                this.soundManager.play('damage');
                                this.flashScreen('red');
                                this.game.combo = 0;
                            } else {
                                this.soundManager.play('powerup');
                                this.game.powerUps.shield = false;
                            }
                        } else {
                            const coinMultiplier = this.game.powerUps.doubleCoins ? 2 : 1;
                            const comboMultiplier = 1 + (this.game.combo * 0.1);
                            
                            this.game.coins += Math.floor(item.value * this.game.upgrades.coinValue * coinMultiplier);
                            this.game.score += Math.floor(item.points * comboMultiplier);
                            this.game.stats.itemsCollected++;
                            this.game.stats.totalCoinsThisRun += item.value;
                            
                            this.game.combo++;
                            this.game.maxCombo = Math.max(this.game.maxCombo, this.game.combo);
                            this.updateComboDisplay();
                            
                            this.soundManager.play('collect');
                            this.flashScreen('gold');
                            
                            // Check achievements
                            this.checkAchievements();
                        }
                        
                        obj.element.remove();
                        this.game.fallingItems.splice(index, 1);
                        
                        // Check for level up
                        if (this.game.score > this.game.level * 100) {
                            this.game.level++;
                            this.soundManager.play('levelup');
                        }
                    }
                    
                    // Magnet effect
                    if (this.game.powerUps.magnet && !obj.item.harmful) {
                        const magnetRange = 100 * this.game.upgrades.magnetRange;
                        const distance = Math.abs(itemRect.left - cartRect.left);
                        
                        if (distance < magnetRange) {
                            const pullSpeed = 5;
                            const direction = cartRect.left > itemRect.left ? pullSpeed : -pullSpeed;
                            obj.element.style.left = (parseFloat(obj.element.style.left) + direction) + 'px';
                        }
                    }
                });
            }

            updateComboDisplay() {
                const comboDisplay = document.getElementById('comboDisplay');
                const comboText = document.getElementById('comboText');
                
                if (this.game.combo > 1) {
                    comboText.textContent = `Combo x${this.game.combo}!`;
                    comboDisplay.classList.add('active');
                } else {
                    comboDisplay.classList.remove('active');
                }
            }

            checkAchievements() {
                const unlocked = [];
                
                // Check various achievement conditions
                unlocked.push(...this.achievementSystem.check('coins', this.game.coins));
                unlocked.push(...this.achievementSystem.check('total_coins', this.game.stats.totalCoinsThisRun));
                unlocked.push(...this.achievementSystem.check('score', this.game.score));
                unlocked.push(...this.achievementSystem.check('level', this.game.level));
                unlocked.push(...this.achievementSystem.check('combo', this.game.combo));
                unlocked.push(...this.achievementSystem.check('powerups_used', this.game.stats.powerupsUsed));
                
                const timeAlive = Math.floor((Date.now() - this.game.startTime) / 1000);
                unlocked.push(...this.achievementSystem.check('time', timeAlive));
                
                // Show achievement popups
                unlocked.forEach(achievement => {
                    this.showAchievementPopup(achievement);
                    
                    // Add to user's achievements
                    if (this.userAccount.currentUser && !this.userAccount.currentUser.achievements.includes(achievement.id)) {
                        this.userAccount.currentUser.achievements.push(achievement.id);
                        this.userAccount.updateUserData(this.userAccount.currentUser);
                    }
                });
            }

            showAchievementPopup(achievement) {
                const popup = document.getElementById('achievementPopup');
                const nameElement = document.getElementById('achievementName');
                
                nameElement.textContent = achievement.name;
                popup.classList.add('active');
                this.soundManager.play('achievement');
                
                setTimeout(() => {
                    popup.classList.remove('active');
                }, 3000);
            }

            flashScreen(color) {
                const canvas = document.getElementById('gameCanvas');
                canvas.style.transition = 'background 0.2s';
                canvas.style.background = color === 'red' ? 'rgba(255,0,0,0.3)' : 'rgba(255,215,0,0.3)';
                setTimeout(() => {
                    canvas.style.background = '';
                }, 200);
            }

            checkGameOver() {
                if (this.game.lives <= 0 || this.game.blockageLevel >= 0.75) {
                    this.gameOver();
                }
            }

            gameOver() {
                this.game.isGameOver = true;
                const finalTime = Math.floor((Date.now() - this.game.startTime) / 1000);
                
                // Update user stats
                if (this.userAccount.currentUser) {
                    const user = this.userAccount.currentUser;
                    const isNewRecord = this.game.score > (user.bestScore || 0);
                    
                    if (isNewRecord) {
                        user.bestScore = this.game.score;
                        document.getElementById('newRecord').style.display = 'block';
                    } else {
                        document.getElementById('newRecord').style.display = 'none';
                    }
                    
                    user.totalCoins += this.game.coins;
                    user.stats.totalPlayTime += finalTime;
                    
                    this.userAccount.updateUserData(user);
                    
                    // Submit to leaderboard
                    this.leaderboardSystem.submitScore(user.username, this.game.score);
                }
                
                document.getElementById('finalScore').textContent = this.game.score;
                document.getElementById('finalCoins').textContent = this.game.coins;
                document.getElementById('finalLevel').textContent = this.game.level;
                document.getElementById('finalTime').textContent = finalTime;
                document.getElementById('gameOver').classList.add('active');
                
                this.soundManager.play('gameover');
            }

            updateUI() {
                document.getElementById('coins').textContent = this.game.coins;
                document.getElementById('score').textContent = this.game.score;
                document.getElementById('level').textContent = this.game.level;
                document.getElementById('lives').textContent = this.game.lives;
                
                // Update shop balance
                document.getElementById('shopCoins').textContent = this.userAccount.currentUser ? 
                    this.userAccount.currentUser.totalCoins : 0;
                document.getElementById('shopGems').textContent = this.userAccount.currentUser ? 
                    this.userAccount.currentUser.totalGems : 0;
            }

            moveCart(direction) {
                if (this.game.isPaused || this.game.isGameOver) return;
                
                const cart = document.getElementById('cart');
                const speed = this.game.cartSpeed * (this.game.powerUps.boost ? 2 : 1);
                const newPosition = this.game.cartPosition + (direction * speed);
                const cartWidth = 60 * this.game.upgrades.cartSize;
                
                if (newPosition >= cartWidth/2 && newPosition <= window.innerWidth - cartWidth/2) {
                    const blockageRestriction = this.game.missedItems.some(item => {
                        return Math.abs(item.x - newPosition) < cartWidth;
                    });
                    
                    if (!blockageRestriction || this.game.blockageLevel < 0.5) {
                        this.game.cartPosition = newPosition;
                        cart.style.left = (newPosition - cartWidth/2) + 'px';
                        cart.style.width = cartWidth + 'px';
                    }
                }
            }

            // Power-up functions
            activateVacuum() {
                if (this.game.coins >= 50) {
                    this.game.coins -= 50;
                    this.game.stats.powerupsUsed++;
                    
                    const cartX = this.game.cartPosition;
                    const range = 150;
                    
                    this.game.missedItems = this.game.missedItems.filter(item => {
                        if (Math.abs(item.x - cartX) <= range) {
                            item.element.remove();
                            this.game.coins += 1;
                            return false;
                        }
                        return true;
                    });
                    
                    this.userAccount.addTransaction('spend', 50, 'Vacuum Power-up');
                    this.soundManager.play('powerup');
                    this.updateBlockage();
                    this.updateUI();
                }
            }

            clearAllItems() {
                if (this.game.coins >= 100) {
                    this.game.coins -= 100;
                    this.game.stats.powerupsUsed++;
                    
                    this.game.missedItems.forEach(item => {
                        item.element.remove();
                        this.game.coins += 1;
                    });
                    this.game.missedItems = [];
                    this.game.blockageLevel = 0;
                    
                    this.userAccount.addTransaction('spend', 100, 'Clear All Power-up');
                    this.soundManager.play('powerup');
                    this.updateUI();
                }
            }

            activateMagnet() {
                if (this.game.coins >= 75) {
                    this.game.coins -= 75;
                    this.game.stats.powerupsUsed++;
                    this.game.powerUps.magnet = true;
                    
                    const powerBar = document.getElementById('powerUpBar');
                    powerBar.classList.add('active');
                    const fill = powerBar.querySelector('.power-up-fill');
                    fill.style.width = '100%';
                    
                    let duration = 10000;
                    let elapsed = 0;
                    
                    const interval = setInterval(() => {
                        elapsed += 100;
                        const remaining = Math.max(0, 100 - (elapsed / duration * 100));
                        fill.style.width = remaining + '%';
                        
                        if (elapsed >= duration) {
                            clearInterval(interval);
                            this.game.powerUps.magnet = false;
                            powerBar.classList.remove('active');
                        }
                    }, 100);
                    
                    this.userAccount.addTransaction('spend', 75, 'Magnet Power-up');
                    this.soundManager.play('powerup');
                    this.updateUI();
                }
            }

            activateBoost() {
                if (this.game.coins >= 25) {
                    this.game.coins -= 25;
                    this.game.stats.powerupsUsed++;
                    this.game.powerUps.boost = true;
                    
                    setTimeout(() => {
                        this.game.powerUps.boost = false;
                    }, 5000);
                    
                    this.userAccount.addTransaction('spend', 25, 'Boost Power-up');
                    this.soundManager.play('powerup');
                    this.updateUI();
                }
            }

            // Shop functions
            openShop() {
                this.game.isPaused = true;
                document.getElementById('shopModal').classList.add('active');
                this.loadShopItems('skins');
                this.updateUI();
            }

            closeShop() {
                document.getElementById('shopModal').classList.remove('active');
                this.game.isPaused = false;
            }

            loadShopItems(category) {
                const container = document.getElementById('shopItems');
                const transactionList = document.getElementById('transactionList');
                
                container.innerHTML = '';
                container.style.display = 'grid';
                transactionList.style.display = 'none';
                
                if (category === 'history') {
                    container.style.display = 'none';
                    transactionList.style.display = 'block';
                    this.loadTransactionHistory();
                    return;
                }
                
                const items = this.shopData[category];
                
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'shop-item';
                    
                    if (item.purchased) {
                        div.classList.add('purchased');
                    }
                    
                    if (category === 'skins' && item.id === this.game.selectedSkin) {
                        div.classList.add('equipped');
                    }
                    
                    div.innerHTML = `
                        <div class="shop-item-icon">${item.icon}</div>
                        <div class="shop-item-name">${item.name}</div>
                        <div class="shop-item-price">${item.purchased ? 'Owned' : item.price + '💰'}</div>
                    `;
                    
                    div.onclick = () => {
                        if (!this.userAccount.currentUser) return;
                        
                        if (category === 'skins') {
                            if (item.purchased) {
                                this.applySkin(item.id);
                                this.loadShopItems('skins');
                            } else if (this.userAccount.currentUser.totalCoins >= item.price) {
                                this.userAccount.currentUser.totalCoins -= item.price;
                                item.purchased = true;
                                this.game.purchasedSkins.push(item.id);
                                this.applySkin(item.id);
                                
                                this.userAccount.addTransaction('purchase', item.price, item.name);
                                this.userAccount.updateUserData(this.userAccount.currentUser);
                                this.soundManager.play('powerup');
                                
                                this.updateUI();
                                this.loadShopItems('skins');
                            }
                        } else if (category === 'upgrades') {
                            if (item.level < item.maxLevel && this.userAccount.currentUser.totalCoins >= item.price) {
                                this.userAccount.currentUser.totalCoins -= item.price;
                                item.level++;
                                
                                if (item.id === 'size') this.game.upgrades.cartSize += 0.2;
                                if (item.id === 'speed') this.game.upgrades.cartSpeed += 0.2;
                                if (item.id === 'magnet') this.game.upgrades.magnetRange += 0.3;
                                if (item.id === 'value') this.game.upgrades.coinValue += 0.5;
                                
                                item.price = Math.floor(item.price * 1.5);
                                
                                this.userAccount.addTransaction('purchase', item.price, item.name);
                                this.userAccount.updateUserData(this.userAccount.currentUser);
                                this.soundManager.play('powerup');
                                
                                this.updateUI();
                                this.loadShopItems('upgrades');
                            }
                        }
                    };
                    
                    container.appendChild(div);
                });
            }

            loadTransactionHistory() {
                const container = document.getElementById('transactionList');
                container.innerHTML = '';
                
                if (!this.userAccount.currentUser || !this.userAccount.currentUser.transactions) {
                    container.innerHTML = '<div style="color: white; text-align: center;">No transactions yet</div>';
                    return;
                }
                
                this.userAccount.currentUser.transactions.forEach(transaction => {
                    const div = document.createElement('div');
                    div.className = 'transaction-item';
                    
                    const date = new Date(transaction.timestamp);
                    const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    div.innerHTML = `
                        <span>${transaction.item} - ${dateStr}</span>
                        <span class="transaction-amount ${transaction.type === 'spend' || transaction.type === 'purchase' ? 'spent' : ''}">
                            ${transaction.type === 'earn' ? '+' : '-'}${transaction.amount}💰
                        </span>
                    `;
                    
                    container.appendChild(div);
                });
            }

            applySkin(skinId) {
                const cart = document.getElementById('cart');
                cart.className = '';
                if (skinId === 'gold') {
                    cart.className = 'gold-skin';
                } else if (skinId === 'diamond') {
                    cart.className = 'diamond-skin';
                } else if (skinId === 'rainbow') {
                    cart.className = 'rainbow-skin';
                }
                this.game.selectedSkin = skinId;
                this.saveGameData();
            }

            saveGameData() {
                const data = {
                    purchasedSkins: this.game.purchasedSkins,
                    selectedSkin: this.game.selectedSkin,
                    upgrades: this.game.upgrades
                };
                localStorage.setItem('potOfGoldGameData', JSON.stringify(data));
            }

            loadGameData() {
                const saved = localStorage.getItem('potOfGoldGameData');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.game.purchasedSkins = data.purchasedSkins || ['default'];
                    this.game.selectedSkin = data.selectedSkin || 'default';
                    this.game.upgrades = data.upgrades || this.game.upgrades;
                    
                    this.shopData.skins.forEach(skin => {
                        skin.purchased = this.game.purchasedSkins.includes(skin.id);
                    });
                    
                    this.applySkin(this.game.selectedSkin);
                }
            }

            // Leaderboard functions
            openLeaderboard() {
                document.getElementById('leaderboardModal').classList.add('active');
                this.loadLeaderboard('daily');
            }

            closeLeaderboard() {
                document.getElementById('leaderboardModal').classList.remove('active');
            }

            loadLeaderboard(period) {
                const container = document.getElementById('leaderboardList');
                container.innerHTML = '';
                
                const entries = this.leaderboardSystem.getLeaderboard(period, 10);
                
                if (entries.length === 0) {
                    container.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">No scores yet. Be the first!</div>';
                    return;
                }
                
                entries.forEach((entry, index) => {
                    const div = document.createElement('div');
                    div.className = 'leaderboard-item';
                    
                    if (this.userAccount.currentUser && entry.username === this.userAccount.currentUser.username) {
                        div.classList.add('current-user');
                    }
                    
                    const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                    const rankEmoji = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `#${index + 1}`;
                    
                    div.innerHTML = `
                        <span class="leaderboard-rank ${rankClass}">${rankEmoji}</span>
                        <span class="leaderboard-name">${entry.username}</span>
                        <span class="leaderboard-score">${entry.score}</span>
                    `;
                    
                    container.appendChild(div);
                });
            }

            // Achievements functions
            openAchievements() {
                document.getElementById('achievementsModal').classList.add('active');
                this.loadAchievements();
            }

            closeAchievements() {
                document.getElementById('achievementsModal').classList.remove('active');
            }

            loadAchievements() {
                const container = document.getElementById('achievementsGrid');
                container.innerHTML = '';
                
                this.achievementSystem.achievements.forEach(achievement => {
                    const div = document.createElement('div');
                    div.className = 'achievement-item';
                    
                    if (achievement.unlocked) {
                        div.classList.add('unlocked');
                    }
                    
                    const progress = achievement.target ? (achievement.progress / achievement.target * 100) : 0;
                    
                    div.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-progress">
                            <div class="achievement-progress-fill" style="width: ${progress}%"></div>
                        </div>
                    `;
                    
                    div.title = achievement.description;
                    container.appendChild(div);
                });
            }

            // Login functions
            showLogin() {
                document.getElementById('loginModal').classList.add('active');
            }

            hideLogin() {
                document.getElementById('loginModal').classList.remove('active');
            }

            togglePause() {
                this.game.isPaused = !this.game.isPaused;
                
                if (this.game.isPaused) {
                    document.getElementById('pauseMenu').classList.add('active');
                } else {
                    document.getElementById('pauseMenu').classList.remove('active');
                    this.gameLoop();
                }
            }

            restart() {
                document.getElementById('pauseMenu').classList.remove('active');
                document.getElementById('gameOver').classList.remove('active');
                
                this.resetGame();
                this.game.isPaused = false;
                this.game.isGameOver = false;
                this.game.startTime = Date.now();
                
                this.gameLoop();
                this.spawnItems();
            }

            returnToMainMenu() {
                document.getElementById('gameContainer').classList.remove('active');
                document.getElementById('pauseMenu').classList.remove('active');
                document.getElementById('gameOver').classList.remove('active');
                document.getElementById('mainMenu').classList.remove('hidden');
                
                this.resetGame();
                this.updateUserDisplay();
            }

            setupEventListeners() {
                // Main menu buttons
                document.getElementById('playBtn').onclick = () => {
                    this.soundManager.play('button');
                    this.startGame();
                };
                
                document.getElementById('leaderboardBtn').onclick = () => {
                    this.soundManager.play('button');
                    this.openLeaderboard();
                };
                
                document.getElementById('achievementsBtn').onclick = () => {
                    this.soundManager.play('button');
                    this.openAchievements();
                };
                
                document.getElementById('accountBtn').onclick = () => {
                    this.soundManager.play('button');
                    this.showLogin();
                };
                
                document.getElementById('settingsBtn').onclick = () => {
                    this.soundManager.play('button');
                    // Settings not implemented yet
                };

                // Login modal
                document.getElementById('loginBtn').onclick = () => {
                    const username = document.getElementById('usernameInput').value;
                    const password = document.getElementById('passwordInput').value;
                    
                    if (this.userAccount.login(username, password)) {
                        this.hideLogin();
                        this.updateUserDisplay();
                        this.soundManager.play('achievement');
                    } else {
                        alert('Invalid username or password');
                    }
                };
                
                document.getElementById('signupBtn').onclick = () => {
                    const username = document.getElementById('usernameInput').value;
                    const password = document.getElementById('passwordInput').value;
                    
                    if (!username || !password) {
                        alert('Please enter a username and password');
                        return;
                    }
                    
                    if (this.userAccount.signup(username, password)) {
                        this.hideLogin();
                        this.updateUserDisplay();
                        this.soundManager.play('achievement');
                    } else {
                        alert('Username already exists');
                    }
                };
                
                document.getElementById('guestBtn').onclick = () => {
                    this.userAccount.playAsGuest();
                    this.hideLogin();
                    this.updateUserDisplay();
                    this.soundManager.play('button');
                };
                
                document.getElementById('closeLogin').onclick = () => {
                    this.hideLogin();
                };

                // Sound toggle
                document.getElementById('soundToggle').onclick = () => {
                    const enabled = this.soundManager.toggle();
                    document.getElementById('soundToggle').textContent = enabled ? '🔊' : '🔇';
                    this.soundManager.play('button');
                };

                // Game controls
                document.getElementById('pauseBtn').onclick = () => this.togglePause();
                document.getElementById('resumeBtn').onclick = () => this.togglePause();
                document.getElementById('restartBtn').onclick = () => this.restart();
                document.getElementById('mainMenuPauseBtn').onclick = () => this.returnToMainMenu();
                
                // Shop
                document.getElementById('shopBtn').onclick = () => this.openShop();
                document.getElementById('shopPauseBtn').onclick = () => this.openShop();
                document.getElementById('closeShopBtn').onclick = () => this.closeShop();
                
                // Shop tabs
                document.querySelectorAll('.shop-tab').forEach(tab => {
                    tab.onclick = () => {
                        document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.loadShopItems(tab.dataset.tab);
                    };
                });
                
                // Leaderboard
                document.getElementById('closeLeaderboardBtn').onclick = () => this.closeLeaderboard();
                
                document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                    tab.onclick = () => {
                        document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.loadLeaderboard(tab.dataset.period);
                    };
                });
                
                // Achievements
                document.getElementById('closeAchievementsBtn').onclick = () => this.closeAchievements();
                
                // Power-ups
                document.getElementById('vacuumBtn').onclick = () => this.activateVacuum();
                document.getElementById('clearBtn').onclick = () => this.clearAllItems();
                document.getElementById('magnetBtn').onclick = () => this.activateMagnet();
                document.getElementById('boostBtn').onclick = () => this.activateBoost();
                
                // Game over
                document.getElementById('playAgainBtn').onclick = () => this.restart();
                document.getElementById('mainMenuBtn').onclick = () => this.returnToMainMenu();

                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') this.moveCart(-1);
                    if (e.key === 'ArrowRight') this.moveCart(1);
                    if (e.key === ' ' || e.key === 'p') this.togglePause();
                });

                // Touch controls
                let touchMoveInterval = null;

                document.getElementById('leftTouch').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    touchMoveInterval = setInterval(() => this.moveCart(-1), 50);
                });

                document.getElementById('rightTouch').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    touchMoveInterval = setInterval(() => this.moveCart(1), 50);
                });

                document.addEventListener('touchend', () => {
                    if (touchMoveInterval) {
                        clearInterval(touchMoveInterval);
                        touchMoveInterval = null;
                    }
                });

                // Mouse controls
                document.getElementById('leftTouch').addEventListener('mousedown', () => {
                    touchMoveInterval = setInterval(() => this.moveCart(-1), 50);
                });

                document.getElementById('rightTouch').addEventListener('mousedown', () => {
                    touchMoveInterval = setInterval(() => this.moveCart(1), 50);
                });

                document.addEventListener('mouseup', () => {
                    if (touchMoveInterval) {
                        clearInterval(touchMoveInterval);
                        touchMoveInterval = null;
                    }
                });

                // Handle resize
                window.onresize = () => {
                    const cart = document.getElementById('cart');
                    const cartWidth = 60 * this.game.upgrades.cartSize;
                    
                    if (this.game.cartPosition > window.innerWidth - cartWidth/2) {
                        this.game.cartPosition = window.innerWidth - cartWidth/2;
                        cart.style.left = (this.game.cartPosition - cartWidth/2) + 'px';
                    }
                };
            }
        }

        // Start the game
        const game = new PotOfGoldGame();
    </script>
</body>
</html>